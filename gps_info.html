<!DOCTYPE html>
<html>
	<head>
		<title>Image GPSLocation information Test</title>
		<meta content="text/html;charset=UTF-8" http-equiv="content-type"/>
		<meta HTTP-EQUIV="REFRESH" content="0; url=http://www.peterrobie.com/test_bed/gps_info.php">
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script> <!-- Base jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script> <!-- jQuery UI -->
		<!-- <script src="http://www.nihilogic.dk/labs/exifjquery/jquery.exif.js"></script> For getting Exif data from images -->
		<script src="http://maps.google.com/maps/api/js?sensor=false"></script> <!-- For getting Google Maps -->
		<script src="gps_js/gps.min.js"></script> <!-- Base GPS functions -->
		<!-- Including the HTML5 Uploader plugin -->
		<script src="/test_bed/html5fu/assets/js/jquery.filedrop.js"></script>
		<!-- The main script file -->
	    <script src="/test_bed/html5fu/assets/js/script.js"></script>
	    <script src="gps_js/jquery.exif.js"></script>
		<script type="text/javascript">
			/* File listing */
			
			function someShit() {
				// console.log('it works...');
				
				var longitude = $(this).exif("GPSLongitude");
				var latitude = $(this).exif("GPSLatitude");
				
				var latRef = $(this).exif("GPSLatitudeRef");
				var lngRef = $(this).exif("GPSLongitudeRef");
				
				// Let's make the object to a string to split on the ,'s
				var a1 = new Array();
				var a2 = new Array();
				
				a1=longitude.toString().split(',');
				a2=latitude.toString().split(',');
				
				if(lngRef == "W") {
					a1[0] = Number(a1[0]);
					a1[0] = -a1[0];
				}
			    
			    if(latRef == "S") {
					a2[0] = Number(a2[0]);
					a2[0] = -a2[0];
				}
			    
			    // Log all of out exif data
			     console.log($(this).exifPretty());
			    
			    /* Populate the fields with the correct data */
			    // Latitude
			    var LatDegrees = parseInt(a2[0]);
			    var LatMinutes = parseInt(a2[1]);
			    var LatSeconds = parseInt(a2[2]);
			    // Longitude
			    var LonDegrees = parseInt(a1[0]);
			    var LonMinutes = parseInt(a1[1]);
			    var LonSeconds = parseInt(a1[2]);
			    
			    toDecimal(LatDegrees, LatMinutes, LatSeconds, LonDegrees, LonMinutes, LonSeconds);
			    
			    var $tabs = $('#tabs');
			    
			    if($tabs.tabs('option', 'selected') == '0') {
					$tabs.tabs('select', 2);
			    }
			}
			
				
			$(document).ready(function(){
			
				$.ajax({
					type: "GET",
					url:"gps_image_list.php",
					timeout: 3000,
					success:function(result){
				    	img_result = $("#image_list").html(result);
				    }
				});
				
				
				$('.img').live("click", function(){
					someShit(this);
				}); // End IMG.click
					
				
				$(function() {
					$( "#tabs" ).tabs();
					
					$('#tabs').bind('tabsshow', function(event, ui) {
					    if (ui.panel.id == "tabs-3") {
					    	initializeDirections(LatDecimalDegrees, LonDecimalDegrees);
					    }
					    if (ui.panel.id == "tabs-2") {
					    	initialize(LatDecimalDegrees, LonDecimalDegrees);
					    }
					});
				});
				
			});
		</script>
		
		<!-- CSS Declarations -->
		<link rel="stylesheet" href="gps.css" type="text/css" />
		<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/cupertino/jquery-ui.css" type="text/css" />
		<link rel="stylesheet" href="/test_bed/html5fu/assets/css/styles.css" />
	</head>
	
	<body>
	
		<div id="wrapper">
			<header>
				<a href="/test_bed/gps_info.html"><img id="logo" src="/images/photoNav_01.png" /></a>
				<!-- <h1>GeoLocation and GPS Image Data Example</h1>
				<p>
					An example of using Exif meta-data to get the GPS location information stored within a mobile image... 
					Clicking on an image will place a marker on a Google Map. Additional things to-do is to create driving 
					directions based on the HTML5 <strong>&lt;geolocation&gt;</strong> tag (and to make this page look nicer!)<p/>
				</p> -->
			</header>

			<section>
				<article id="image_list">
					<img src="/test_bed/html5fu/uploads/mary_koster.jpg" class="img" exif="true" />
				</article>
			</section>
			
			<br style="clear: both;" />
			
			<section>
				<article>
					<h3>Upload your image</h3>

					<div id="dropbox">
						<span class="message">Drop images here to upload. <br /><i>(they will only be visible to you)</i></span>
					</div>

					<div class="message"></div>
				</article>
			</section>
			
			<br style="clear: both;" />

			<section>
				<article>
					<div id="tabs">
						<ul>
							<li><a href="#tabs-1">Overview</a></li>
							<li><a href="#tabs-2">Map Overview</a></li>
							<li><a href="#tabs-3">Driving Directions</a></li>
							<li><a href="#tabs-4">Textural Route</a></li>
							<!-- <li><a href="#tabs-3">Verbose Directions</a></li> -->
						</ul>
						<div id="tabs-1">
							<p><strong>Overview:</strong> This example is to get GPS data stored from images to be able to return to
							the location that the image was originally taken from based on your current location. Other great uses 
							would be for your friends to be able to visit these locations such as parks, landmarks or points of interest.</p> 
							 
							<p><strong class="alert">DIRECTIONS/NOTES:</strong> Once you click on the image, you will get the map / directions. Clicking on the TAB there is 
							a bug that requires you to click on the image again to refresh the data in that pane.</p>
						</div>
						<div id="tabs-2">
							<!-- Placeholder for Google Maps -->
							<div id="map_canvas"></div>
						</div>
						<div id="tabs-3">
							<div id="map_canvas2"></div>
						</div>
						<div id="tabs-4">	
							<div id="route"></div>
						</div>
					</div>
						<div id="current_location">
							<h3>Current Coordinates</h3>
							<span id="latitude"></span>, <span id="longitude"></span> within: <span id="accuracy"></span> meters.						
						</div>
					</div>
				</article>
			</section>
			
			<!-- 
			<footer>
				<span id="footer_text">
					<h3>Image GPS Extraction</h3>
					<h5>
						Written by: Peter Robie<br/>
						March, 2012
					</h5>
				</span>
				<span id="status"></span>
			</footer>
			 -->
		</div>
	</body>
	
	<script type="text/javascript">loadGeoData();</script>
</html>
